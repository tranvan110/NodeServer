var _breadcrumb='<ul class="breadcrumb"><li><a href="#">Home</a></li><li><a href="#">Pictures</a></li><li><a href="#">Summer 15</a></li><li><a href="#">Italy</a></li></ul>';
var _card='<section><h2>Sản phẩm nổi bật</h2><div class="row"><div class="col sm-6 md-4 lg-3 xl-2"><a class="card" href="/product"><div class="ratio-1-1"><img class="ratio-elm" src="/assets/img/iphone.jpg" alt="" /><div class="discount"><svg width="40" height="30"><path d="M0,0 L40,0 L40,20 L20,30 L0,20 Z" /></svg><span class="abs-center">-15%</span></div></div><span class="title">This is image from my website</span><div class="price middle space"><span>12.000đ</span><img src="/assets/img/payment-icons/free-delivery.svg" alt="" /></div><div class="star middle space"><div class="flex"><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xe839;</i><i class="fgr">&#xf06f;</i></div><span>Đã bán 130</span></div><span class="seller">Shopee</span></a></div><div class="col sm-6 md-4 lg-3 xl-2"><a class="card" href=""><div class="ratio-1-1"><img class="ratio-elm" src="/assets/img/paris.jpg" alt="" /></div><span class="title">This is image from my website</span><div class="price middle space"><span>12.000đ</span><img src="/assets/img/payment-icons/free-delivery.svg" alt="" /></div><div class="star middle space"><div class="flex"><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i></div><span>Đã bán 130</span></div><span class="seller">Shopee</span></a></div><% for(var $item in $data[\'items\']){$item=$data[\'items\'][$item]; %><div class="col sm-6 md-4 lg-3 xl-2"><a class="card" href=""><div class="ratio-1-1"><img class="ratio-elm fakeimg" src="" alt="" /></div><span class="title">This is image from fds fds fdsfds website</span><div class="price middle space"><span>12.000đ</span><img src="/assets/img/payment-icons/free-delivery.svg" alt="" /></div><div class="star middle space"><div class="flex"><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xe839;</i><i class="fgr">&#xf06f;</i><i class="fgr">&#xf06f;</i></div><span>Đã bán 130</span></div><span class="seller">Shopee</span></a></div><% } %></div></section>';
var _carts='<section class="carts"><div class="row title middle center"><label class="col sm-1 checkbox"><input type="checkbox"><i class="checkmark">&#x2714;</i></label><h2 class="col sm-11 md-show">Giỏ hàng</h2><div class="col sm-2 xl-1 md-hide"><span>Hình ảnh</span></div><div class="col sm-9 xl-10 md-hide"><div class="row"><div class="col lg-7"><span>Mô tả</span></div><div class="col lg-2"><span>Số lượng</span></div><div class="col lg-2"><span>Đơn giá</span></div><div class="col lg-1"><span></span></div></div></div></div><div class="row item middle"><label class="col sm-1 checkbox"><input type="checkbox" checked="true"><i class="checkmark">&#x2714;</i></label><div class="col sm-2 xl-1"><img src="/assets/img/iphone.jpg" alt="" /></div><div class="col sm-9 xl-10"><div class="row"><div class="col sm-12 lg-7 middle"><span class="md-ellipsis align-left">Áo Khoác Thun Nữ Rằn Ri Có Nón Chống Nắng Ôm Body Siêu Đẹp Mềm Mịn Mỏng Mát</span></div><div class="col sm-6 lg-2 number-input center middle"><button class="button xl-hide">-</button><input class="input" type="number" value="1" /><button class="button xl-hide">+</button></div><span class="col sm-4 lg-2 center middle">123.000đ</span><a class="col sm-2 lg-1 center middle">Xóa</a></div></div></div><div class="row item middle"><label class="col sm-1 checkbox"><input type="checkbox" checked="true"><i class="checkmark">&#x2714;</i></label><div class="col sm-2 xl-1"><img src="/assets/img/paris.jpg" alt="" /></div><div class="col sm-9 xl-10"><div class="row"><div class="col sm-12 lg-7 middle"><span class="md-ellipsis align-left">Áo Khoác Thun Nữ Rằn Ri Có Nón Chống Nắng</span></div><div class="col sm-6 lg-2 number-input center middle"><button class="button xl-hide">-</button><input class="input" type="number" value="1" /><button class="button xl-hide">+</button></div><span class="col sm-4 lg-2 center middle">123.000đ</span><a class="col sm-2 lg-1 center middle">Xóa</a></div></div></div></section><section class="summary"><div class="row"><div class="col md-6"></div><div class="col md-6 total"><div class="pay middle space"><span class="bold">Tổng tiền (1 Sản phẩm)</span><span class="value">123.000đ</span></div><div class="action center"><button class="button" onclick="history.back(-1)">Quay lại</button><a class="button" href="/payment">Mua hàng</a></div></div></div></section>';
var _dots='<div class="dots"><a class="dot"></a><a class="dot"></a><a class="dot"></a><a class="dot"></a></div>';
var _error='<div class="row middle center notfound"><svg width="350px" height="400px" viewBox="0 0 837 1055"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path id="Polygon-1" d="M353,9 L626.664028,170 L626.664028,487 L353,642 L79.3359724,487 L79.3359724,170 L353,9 Z" stroke="#007FB2" stroke-width="6"></path><path id="Polygon-2" d="M78.5,529 L147,569.186414 L147,648.311216 L78.5,687 L10,648.311216 L10,569.186414 L78.5,529 Z" stroke="#EF4A5B" stroke-width="6"></path><path id="Polygon-3" d="M773,186 L827,217.538705 L827,279.636651 L773,310 L719,279.636651 L719,217.538705 L773,186 Z" stroke="#795D9C" stroke-width="6"></path><path id="Polygon-4" d="M639,529 L773,607.846761 L773,763.091627 L639,839 L505,763.091627 L505,607.846761 L639,529 Z" stroke="#F2773F" stroke-width="6"></path><path id="Polygon-5" d="M281,801 L383,861.025276 L383,979.21169 L281,1037 L179,979.21169 L179,861.025276 L281,801 Z" stroke="#36B455" stroke-width="6"></path></g></svg><div class="message"><h1>Oops!</h1><h2>We can\'t seem to find the page you\'re looking for.</h2><div class="row"><a class="button" onclick="history.back(-1)">Go Back</a><a class="button" href="/">Go Home</a></div></div></div>';
var _feature='<div class="feature"><h1>Áo Khoác Thun Nữ Rằn Ri Có Nón Chống Nắng Ôm Body Siêu Đẹp Mềm Mịn Mỏng Mát</h1><div class="middle space"><div class="ratings middle"><div class="middle"><span>4.6</span><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xf0ec;</i><i class="fgr">&#xe839;</i><i class="fgr">&#xf06f;</i></div><span class="lg-hide"><span>100</span> Đánh giá</span></div><div class="share middle"><span>Chia sẻ:</span><img src="/assets/img/social-icons/facebook-round.svg" alt="" /><img src="/assets/img/social-icons/messenger-round.svg" alt="" /><img src="/assets/img/social-icons/twitter-round.svg" alt="" /></div></div><div class="middle space"><div class="price middle"><span class="old lg-hide">150.000đ</span><span class="new">130.000đ</span><span class="discount">Giảm 20%</span></div><span>Đã bán 130</span></div><div class="promotions"><h3>Ưu đãi:</h3><div class="content"><span><i class="fgo">&#xe862;</i>Voucher MoMo - Mua hàng TỪ 1K</span><span><i class="fgo">&#xe862;</i>Mua từ 49.000đ tặng 20.000đ phí vận chuyển</span></div></div><div class="shipping"><h3>Vận chuyển:</h3><div class="content"><span>Phí vận chuyển: <span>35.000đ</span></span><span>Miễn phí vận chuyển khi mua 2 sản phẩm trở lên</span></div></div><div><h3>Màu sắc:</h3><div class="content"><button class="button active">Màu đỏ</button><button class="button">Màu xanh</button><button class="button">Màu vàng</button><button class="button">Màu xanh đen</button><button class="button">Màu xanh rêu</button><button class="button">Màu xanh ngọc</button><button class="button">Màu trắng</button></div></div><div><h3>Chất liệu:</h3><div class="content"><button class="button active">Vải</button><button class="button">Nhựa</button></div></div><div><h3>Kích thước:</h3><div class="content"><button class="button active">Nhỏ</button><button class="button">Lớn</button></div></div><div class="amount"><h3>Số lượng:</h3><div class="content middle space"><div class="number-input"><button class="button">-</button><input class="input" type="number" value="1"/><button class="button">+</button></div><span>100 sản phẩm có sẵn</span></div></div><div class="buy center"><button class="button">Thêm vào giỏ hàng</button><button class="button">Mua ngay sản phẩm</button></div><a href="/">Xem hướng dẫn mua hàng</a></div>';
var _footer='<footer class="sm-hide"><div class="container row"><div class="col sm-6 lg-3"><strong>HỖ TRỢ KHÁCH HÀNG</strong><a href="">Các câu hỏi thường gặp</a><a href="">Hướng dẫn đặt hàng</a><a href="">Hướng dẫn thanh toán</a><a href="">Chính sách giao nhận hàng</a><a href="">Chính sách trả hàng và hoàn tiền</a><a href="">Hướng dẫn mua trả góp</a><a href="">Hướng dẫn & điều kiện sử dụng Voucher</a></div><div class="col sm-6 lg-3"><strong>VỀ THƯƠNG MẠI ĐIỆN TỬ</strong><a href="">Giới thiệu</a><a href="">Tuyển dụng</a><a href="">Quy chế hoạt động</a><a href="">Chính sách bảo mật</a><a href="">Điều khoản sử dụng</a><a href="">Chính sách bảo hành</a><a href="">Điểm tích lũy GIÁ KHO Member</a><a href="">KHO công nghệ</a><a href="">Hệ Thống Cộng Tác Viên Toàn Quốc</a></div><div class="col sm-6 lg-3"><strong>THÔNG TIN HỖ TRỢ</strong><a href="">Bán hàng Doanh nghiệp</a><a href="">Hợp tác cùng GIÁ KHO</a><a href="">Quy định về việc sao lưu dữ liệu</a><a href="">Email: trogiup@dienthoaigiakho.vn</a></div><div class="col sm-6 lg-3"><div class="lg-hide"><strong>PHƯƠNG THỨC THANH TOÁN</strong><div class="row"><div class="col sm-4 tooltip"><img src="/assets/img/payment-icons/visa.svg" alt=""><span>visa</span></div><div class="col sm-4 tooltip"><img src="/assets/img/payment-icons/mastercard.svg" alt=""><span>mastercard</span></div><div class="col sm-4 tooltip"><img src="/assets/img/payment-icons/paypal.svg" alt=""><span>paypal</span></div></div><div class="row"><div class="col sm-4 tooltip"><img src="/assets/img/payment-icons/bank-transfer.svg" alt=""><span>bank transfer</span></div><div class="col sm-4 tooltip"><img src="/assets/img/payment-icons/money.svg" alt=""><span>cash</span></div><div class="col sm-4 tooltip"><img src="/assets/img/payment-icons/bitcoin.svg" alt=""><span>bitcoin</span></div></div></div><strong>KẾT NỐI VỚI CHÚNG TÔI</strong><div class="row"><div class="col sm-3"><img src="/assets/img/social-icons/facebook.svg" alt=""></div><div class="col sm-3"><img src="/assets/img/social-icons/multimedia.svg" alt=""></div><div class="col sm-3"><img src="/assets/img/social-icons/skype.svg" alt=""></div><div class="col sm-3"><img src="/assets/img/social-icons/whatsapp.svg" alt=""></div></div></div></div></footer>';
var _head='<head><meta charset="utf-8" /><meta http-equiv="x-ua-compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="mobile-web-app-capable" content="yes" /><meta name="robots" content="all" data-rh="true" /><meta name="description" content="<% echo ($data[\'description\']); %>" /><meta name="keywords" content="<% echo ($data[\'keywords\']); %>" /><meta name="author" content="<% echo ($data[\'author\']); %>" /><meta property="og:title" content="<% echo ($data[\'title\']); %>" /><meta property="og:type" content="article" /><meta property="og:url" content="http://www.example.com/" /><meta property="og:image" content="http://example.com/image.jpg" /><meta property="og:description" content="<% echo ($data[\'description\']); %>" /><meta property="og:site_name" content="Tên trang web, tức là Moz" /><meta property="og:price: amount" content="15.00" /><meta property="og:price: currency" content="USD" /><title><% echo ($data[\'title\']); %></title><link rel="canonical" href="https://site.vn" data-rh="true" /><link rel="icon" href="/assets/img/favicon.ico"><link rel="stylesheet" href="/assets/css/webfonts/googlefont.css" /><link rel="stylesheet" href="/assets/css/theme-default.css" /></head>';
var _header='<header><div class="container"><div class="row middle"><div class="col sm-2 md-3"><a class="logo middle" href="/"><i class="fgo">&#xe8cc;</i><em class="sm-hide">shoppi</em><em class="lg-hide">.com</em></a></div><div class="col sm-8 md-6 xl-7"><div class="search middle space"><input class="input" type="text" placeholder="Tìm kiếm trên shop.com - HOTLINE 0000123"><button class="button"><i class="fgo">&#xe8b6;</i></button></div></div><div class="col sm-2 md-3 xl-2 end"><a class="cart middle sm-hide" href="/carts"><span><i class="fgo">&#xe8cc;<span>2</span></i>GIỎ HÀNG</span></a><button class="button sm-show" onclick="toggle(\'nav\')"><i class="fgo">&#xe5d2;</i></button></div></div></div></header>';
var _navbar='<nav class="sm-hide"><div class="container"><div class="dropdown sm-block"><a href="#"><i class="fgo">&#xe325;</i>ĐIỆN THOẠI</a><div class="content sm-hide"><strong class="" href="#">Loai A</strong><a href="/product">Dien thoai loai A1</a><a href="/carts">Dien thoai A2</a><strong class="" href="#">Loai B</strong><a href="/api/b1/b2">Dien thoai loai B1</a><a href="/b2">Dien thoai B2</a></div></div><div class="dropdown sm-block"><a href="#"><i class="fgo">&#xe30a;</i>MÁY TÍNH</a><div class="content sm-hide"><strong class="" href="#">Loai A</strong><a href="#">May tinh loai A1</a><a href="#">May tinh A2</a><strong class="" href="#">Loai B</strong><a href="#">May tinh loai B1</a><a href="#">May tinh B2</a></div></div><div class="cart sm-show sm-block"><a href="/carts"><i class="fgo">&#xe8cc;</i>GIỎ HÀNG</a></div><div class="float-right sm-block"><a href="#"><i class="fgo">&#xe174;</i>ĐĂNG KÝ</a><a href="#"><i class="fgo">&#xea77;</i>ĐĂNG NHẬP</a></div></div></nav>';
var _pagination='<div class="pagination align-center"><div class="links"><a class="fgo prev" href="#">&#xe5e0;</a><a href="#">1</a><a class="active" href="#">2</a><a href="#">3</a><a href="#">4</a><a href="#">5</a><a class="fgo next" href="#">&#xe5e1;</a></div></div>';
var _payment='<section class="payment"><div class="row"><div class="col md-6 address"><h2>Địa chỉ nhận hàng</h2><input class="input" type="text" placeholder="Họ và tên" /><input class="input" type="text" placeholder="Số điện thoại" /><div class="select"><label>Tỉnh/Thành phố</label><div class="options"><span data-value="0">Kon Tum</span><span data-value="1">Tỉnh</span><span data-value="2">Thành phố</span></div></div><div class="select"><label>Quận/Huyện</label><div class="options"><span data-value="0">Ngọc Hồi</span><span data-value="1">Quận</span><span data-value="2">Huyện</span></div></div><div class="select"><label>Phường/Xã</label><div class="options"><span data-value="0">Đăk Xú</span><span data-value="1">Phường</span><span data-value="2">Xã</span></div></div><input class="input" type="text" placeholder="Số nhà/Tên đường" /><h2>Ghi chú</h2><textarea></textarea></div><div class="col md-6 paytype"><h2>Hình thức thanh toán</h2><label class="radio"><input type="radio" name="paytype" /><i class="checkmark"></i>Chuyển khoản</label><label class="radio"><input type="radio" name="paytype" /><i class="checkmark"></i>Thanh toán qua airpay</label><label class="radio"><input type="radio" name="paytype" /><i class="checkmark"></i>Thanh toán qua ngân lượng</label><label class="radio disabled"><input type="radio" name="paytype" /><i class="checkmark"></i>Thanh toán khi nhận hàng</label><!-- <span>Vui lòng chuyển 123.000đ tới số tài khoản Vietcombank sau:</span><span>Số TK : 0041 000 322 314</span><span>Chủ TK: TRAN VAN SAU</span><span>Nội dung chuyển khoản: Xf3Fse</span><button class="button">Sao chép</button><span>Chú ý: Bạn hãy chuyển chính xác số tiền(kể cả số lẻ) và nội dung chuyển khoản(phần in đậm) y như hướng dẫn. Trạng thái đơn hàng sẽ được cập nhật trong 1 ngày làm việc.</span> --><h2>Số tiền cần thanh toán</h2><div class="vocher middle space"><span>Mã giảm giá</span><input class="input" type="text" placeholder="Nhập mã giảm giá của bạn"><button class="button">Áp dụng</button></div><!-- <span class="error">Mã giảm giá không hợp lệ</span> --><div><span>Tổng tiền</span><span class="bold">123.000đ</span></div><div><span>Phí giao hàng</span><span>23.000đ</span></div><div><span>Phí thu hộ</span><span>23.000đ</span></div><div><span>Giảm giá</span><span>-23.000đ</span></div><div class="pay middle space"><span class="bold">Cần thanh toán (1 Sản phẩm)</span><span class="value">123.000đ</span></div><div class="action center"><button class="button" onclick="history.back(-1)">Quay lại</button><button class="button">Thanh toán</button></div></div></div></section>';
var _script='<script src="/assets/js/scripts.min.js"></script><%if (RENDERMODE == \'single_page_app\') {echo (\'<script src="/assets/js/index.min.js"></script>\');} else if (ENVIRONMENT == \'development\') {echo (\'<script>\');for(var $logmsg in $GLOBALS[\'logmsg\']){$logmsg=$GLOBALS[\'logmsg\'][$logmsg];echo ($logmsg);}echo (\'</script>\');$GLOBALS[\'logmsg\'] = null;}%>';
var _slides='<div class="slides"><div class="ratio-1-1 zoom"><img class="ratio-elm active" src="/assets/img/trangan.jpg" alt=""/><img class="ratio-elm" src="/assets/img/danang.jpg" alt=""/><img class="ratio-elm" src="/assets/img/ruong.jpg" alt=""/><img class="ratio-elm" src="/assets/img/nature.jpg" alt=""/><div class="zoom-lens sm-hide"></div><div class="zoom-res sm-hide"></div></div><a class="fgo prev abs-middle">&#xe5e0;</a><a class="fgo next abs-middle">&#xe5e1;</a></div>';
var _slideshow='<div class="slideshow"><div class="slides"><div class="slide fade"><div class="number">1 / 3</div><img src="/assets/img/nature.jpg"><div class="caption">Caption One</div></div><div class="slide fade"><div class="number">2 / 3</div><img src="/assets/img/ruong.jpg"><div class="caption">Caption Two</div></div><div class="slide fade"><div class="number">3 / 3</div><img class="fakeimg" src=""><div class="caption">Caption Three</div></div></div><a class="next abs-middle nselect">&#10095;</a><a class="prev abs-middle nselect">&#10094;</a><div class="dots"><a class="dot"></a><a class="dot"></a><a class="dot"></a></div></div><!-- <script type="text/javascript" src="/assets/js/slideshow.js"></script> -->';
var _thumbs='<div class="row thumbs"><div class="col sm-2"><div class="ratio-1-1 thumb active"><img class="ratio-elm" src="/assets/img/trangan.jpg"></div></div><div class="col sm-2"><div class="ratio-1-1 thumb"><img class="ratio-elm" src="/assets/img/danang.jpg"></div></div><div class="col sm-2"><div class="ratio-1-1 thumb"><img class="ratio-elm" src="/assets/img/ruong.jpg"></div></div><div class="col sm-2"><div class="ratio-1-1 thumb"><img class="ratio-elm" src="/assets/img/nature.jpg"></div></div><a class="fgo prev abs-middle">&#xe5e0;</a><a class="fgo next abs-middle">&#xe5e1;</a></div>';
var _about='';
var view_carts='<!DOCTYPE html><html lang="en"><% include(_head); %><body><% include(_header); %><% include(_navbar); %><div class="container"><% include(_carts); %></div><% include(_footer); %><% include(_script); %></body></html>';
var view_error='<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="x-ua-compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="icon" href="/assets/img/favicon.ico" /><link rel="stylesheet" href="/assets/css/webfonts/googlefont.css" /><link rel="stylesheet" href="/assets/css/theme-default.css" /></head><body><div class="container"><% include(_error); %></div><% include(_script); %></body></html>';
var view_home='<!DOCTYPE html><html lang="en"><% include(_head); %><body><% include(_header); %><% include(_navbar); %><div class="container"><div class="slides"><div class="auto"><img class="active" src="/assets/img/trangan.jpg" alt="" /><img class="" src="/assets/img/danang.jpg" alt="" /><img class="" src="/assets/img/ruong.jpg" alt="" /><img class="" src="/assets/img/nature.jpg" alt="" /></div><a class="fgo prev abs-middle">&#xe5e0;</a><a class="fgo next abs-middle">&#xe5e1;</a></div><% include(_card); %><% include(_card); %><% include(_pagination); %></div><% include(_footer); %><% include(_script); %></body></html>';
var view_payment='<!DOCTYPE html><html lang="en"><% include(_head); %><body><% include(_header); %><% include(_navbar); %><div class="container"><% include(_payment); %></div><% include(_footer); %><% include(_script); %></body></html>';
var view_product='<!DOCTYPE html><html lang="en"><% include(_head); %><body><% include(_header); %><% include(_navbar); %><div class="container"><% include(_breadcrumb); %><section class="row"><div class="col md-6 sm-12"><% include(_slides); %><% include(_thumbs); %></div><div class="col md-6 sm-12"><% include(_feature); %></div></section><% include(_pagination); %></div><% include(_footer); %><% include(_script); %></body></html>';
var ENVIRONMENT = 'development';
var RENDERMODE = 'single_page_app';
var routes = {};
routes['/api/$1/$2'] = '/api/$1/$2';
routes['/$1-$2-$3'] = '/$1/$2/$3';
routes['/$1/$2/$3'] = '/$1/$2/$3';
routes['/$1/$2'] = '/$1/$2';
routes['/$1'] = '/$1';
routes['/'] = '/home';
var carts = new controller();

carts.index = function (argument) {
	var data = {};
	data['items'] = [1, 2, 3];
	this.view(view_carts, data);
}
var home = new controller();

home.index = function (argument) {
	var data = {};
	data['items'] = [1, 2, 3];
	this.view(view_home, data);
}
var payment = new controller();

payment.index = function (argument) {
	var data = {};
	data['items'] = [1, 2, 3];
	this.view(view_payment, data);
}
var product = new controller();

product.index = function (argument) {
	var data = {};
	data['items'] = [1, 2, 3];
	this.view(view_product, data);
}
function controller() {
	this.index = function (argument) {
		console.log('NOTE', 'index(' + argument + ') not found');
		this.view(view_error);
	}

	this.view = function(html, argument) {
		document.querySelector("html").innerHTML = EjsParser(html, argument);
	}

	return this;
}
function model() {

	this.get = function (url, callback) {
		HttpGet(url, callback(JSON.parse(res)));
	}

	return this;
}
//////////////////////////////////////////////////////////////////////////////////
function Router(path) {
	var match = false;
	var expaths, object, method, argument;
	path = path.replace(/[{}<>$]/g, '');

	for (var key in routes) {
		var re, regex, matches, count;
		regex = '^' + key.replace(/\//g, '\\/');
		regex = regex.replace(/\$1/g, '(.+)');
		regex = regex.replace(/\$2/g, '(.+)');
		regex = regex.replace(/\$3/g, '(.+)');

		re = new RegExp(regex, 'g');
		matches = re.exec(path);
		if (matches) {
			expaths = routes[key];
			count = matches.length;
			if (count > 1)
				expaths = expaths.replace(/\$1/g, matches[1]);
			if (count > 2)
				expaths = expaths.replace(/\$2/g, matches[2]);
			if (count > 3)
				expaths = expaths.replace(/\$3/g, matches[3]);

			match = true;
			break;
		}
	}

	if (!match) {
		(controller()).view(view_error);
		console.log('NOTE', 'routes[' + path + '] not found');
		return;
	}

	expaths = expaths.split('/');
	count = expaths.length;

	if (count > 3)
		argument = expaths[3];
	else
		argument = '';
	if (count > 2)
		method = expaths[2];
	else
		method = 'index';
	if (count > 1)
		object = expaths[1];
	else
		object = 'home';

	if (object == '')
		object = 'home';
	if (method == '')
		method = 'index';

	if (!$GLOBALS[object]) {
		console.log('NOTE', object + '->' + method + '(' + argument + ') not found');
		(controller()).view(view_error);
		return;
	}

	if (!$GLOBALS[object][method]) {
		console.log('NOTE', $method + '(' + argument + ') not found');
		(controller()).view(view_error);
		return;
	}

	$GLOBALS[object][method](argument);
}
//////////////////////////////////////////////////////////////////////////////////
var $GLOBALS;

try {
	$GLOBALS = Function('return this')() || (42, eval)('this');
} catch (e) {
	$GLOBALS = window;
}

//////////////////////////////////////////////////////////////////////////////////
function EjsParser(html, argument) {
	var result, match, cursor = 0;
	var jsExp = /<%([^%]+)%>/g;
	var addExp = /.*[=:;{}].*$/g;
	var code = 'var str = [];\n';

	function add(line, js) {
		if (js) {
			if (line.match(addExp)) {
				line = line.replace(/echo/g, 'str.push');
				line = line.replace(/include *\((.+)\)/g, 'str.push(EjsParser($1,\$data))');
				code += line + '\n';
			}
			else {
				code += 'str.push(' + line + ');\n';
			}
		} else if (line != '') {
			line = line.replace(/["]/g, '\\"');
			line = line.replace(/[\t]/g, '\\t');
			line = line.replace(/[\r]/g, '\\r');
			line = line.replace(/[\n]/g, '\\n');
			code += 'str.push("' + line + '");\n';
		}
	}

	while (match = jsExp.exec(html)) {
		add(html.slice(cursor, match.index));
		add(match[1], true);
		cursor = match.index + match[0].length;
	}

	add(html.substr(cursor, html.length - cursor));
	code += 'return str.join("");\n';
	// console.log(code);
	// code = code.replace(/[\t\r\n]/g, '');

	try {
		result = Function('$data', code).call(argument, argument);
	} catch (err) {
		console.error(code + '\n', err);
	}
	return result;
}

//////////////////////////////////////////////////////////////////////////////////
function HttpGet(url, callback) {
	var httpRequest = new XMLHttpRequest();
	httpRequest.onreadystatechange = function () {
		if (httpRequest.readyState == XMLHttpRequest.DONE) {
			if (httpRequest.status == 200)
				callback(httpRequest.responseText);
			else
				console.error('GET' + url + 'error.');
		}
	}
	httpRequest.open('GET', url);
	httpRequest.send(null);
}

//////////////////////////////////////////////////////////////////////////////////
function HttpPost(url, data, callback) {
	var httpRequest = new XMLHttpRequest();
	httpRequest.onreadystatechange = function () {
		if (httpRequest.readyState == XMLHttpRequest.DONE) {
			if (httpRequest.status == 200)
				callback(httpRequest.responseText);
			else
				console.error('POST' + url + 'error.');
		}
	}
	httpRequest.open('POST', url);
	httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	httpRequest.send(data);
}

//////////////////////////////////////////////////////////////////////////////////
function DispatchEvent(elm, evt) {
	var event;
	if (typeof (Event) === 'function') {
		event = new Event(evt, { bubbles: true, cancelable: false });
	} else {
		event = document.createEvent('Event');
		event.initEvent(evt, true, false);
	}
	elm.dispatchEvent(event);
}
// jsmin build
// jsmin build-min

if (ENVIRONMENT != 'development') {
	console.log = function () { };
}

window.addEventListener('popstate', function () {
	DispatchEvent(document, 'DOMContentLoaded');
});

document.addEventListener("DOMContentLoaded", function () {
	Router(window.location.pathname);

	var hrefs = document.querySelectorAll("[href]");
	for (var i = 0; i < hrefs.length; i++) {
		hrefs[i].addEventListener("click", function (event) {
			event.preventDefault();
			history.pushState(null, null, this.href);
			DispatchEvent(document, 'DOMContentLoaded');
		});
	}
});

